<!DOCTYPE html>
<html>
<head>
    <title>Blockchain Console Test</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <h1>ðŸ”§ Blockchain Console Test</h1>
    <div id="output"></div>

    <script>
        const targetAddress = "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266";
        const questNFTAddress = "0x5FbDB2315678afecb367f032d93F642f64180aa3";
        
        // ABI for balanceOf function
        const questNFTABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function getUserNFTCounts(address user) view returns (uint256[])",
            "function canCreatePlant(address user) view returns (bool)",
            "function name() view returns (string)"
        ];

        const log = (message) => {
            console.log(message);
            document.getElementById('output').innerHTML += message + '<br>';
        };

        async function testBlockchain() {
            try {
                log(`ðŸŽ¯ Testing blockchain data for: ${targetAddress}`);
                log(`ðŸ“‹ QuestNFT Contract: ${questNFTAddress}`);
                
                // Connect to local provider
                const provider = new ethers.providers.JsonRpcProvider('http://localhost:8545');
                log('âœ… Connected to local provider');
                
                // Test basic connectivity
                const network = await provider.getNetwork();
                log(`ðŸŒ Network: ${network.name} (Chain ID: ${network.chainId})`);
                
                const blockNumber = await provider.getBlockNumber();
                log(`ðŸ“¦ Current Block: ${blockNumber}`);
                
                // Create contract instance
                const questNFT = new ethers.Contract(questNFTAddress, questNFTABI, provider);
                log('ðŸ“„ Contract instance created');
                
                // Test contract name first
                try {
                    const contractName = await questNFT.name();
                    log(`ðŸ“ Contract Name: ${contractName}`);
                } catch (error) {
                    log(`âŒ Contract Name Error: ${error.message}`);
                }
                
                // Test balance
                try {
                    const balance = await questNFT.balanceOf(targetAddress);
                    log(`ðŸ’° NFT Balance: ${balance.toString()}`);
                    
                    if (balance.gt(0)) {
                        // Get NFT counts by type
                        const nftCounts = await questNFT.getUserNFTCounts(targetAddress);
                        log(`ðŸ“Š NFT Counts: [${nftCounts.map(c => c.toString()).join(', ')}]`);
                        
                        // Check plant creation eligibility
                        const canCreate = await questNFT.canCreatePlant(targetAddress);
                        log(`ðŸŒ± Can Create Plant: ${canCreate}`);
                        
                        // Calculate unique types
                        const uniqueTypes = nftCounts.filter(count => count.gt(0)).length;
                        log(`ðŸŽ¨ Unique Types: ${uniqueTypes}`);
                        
                        log(`âœ… SUCCESS: Found ${balance} NFTs for address!`);
                    } else {
                        log(`âš ï¸ No NFTs found for this address`);
                    }
                    
                } catch (error) {
                    log(`âŒ Balance Error: ${error.message}`);
                }
                
            } catch (error) {
                log(`âŒ Test Failed: ${error.message}`);
            }
        }

        // Auto-run test
        window.onload = () => {
            log('ðŸš€ Starting blockchain test...');
            testBlockchain();
        };
        
        // Make functions globally available for manual testing
        window.testBlockchain = testBlockchain;
        window.targetAddress = targetAddress;
        window.questNFTAddress = questNFTAddress;
    </script>
</body>
</html>
